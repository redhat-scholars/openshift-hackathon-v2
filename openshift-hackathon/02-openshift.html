<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Untitled :: Openshift Hackathon</title>
    <link rel="canonical" href="https://redhat-scholars.github.io/openshift-hackathon-v2/openshift-hackathon/02-openshift.html">
    <link rel="prev" href="01-containers.html">
    <link rel="next" href="03-helm_services.html">
    <meta name="generator" content="Antora 3.0.0">
    <link rel="stylesheet" href="../_/css/site.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://developers.redhat.com" target="_blank"><img src="../_/img/NewRHDFullLogo_4-color_white-wordmark.png" height="40px" alt="Red Hat Developer Program"></a>
      <a class="navbar-item" style="font-size: 24px; color: white" href="https://redhat-scholars.github.io/openshift-hackathon-v2">Openshift Hackathon</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://developers.redhat.com/ebooks/" target="_blank">Books</a>
        <a class="navbar-item" href="https://developers.redhat.com/cheatsheets/" target="_blank">Cheat Sheets</a>
        <a class="navbar-item" href="https://developers.redhat.com/events/" target="_blank">Upcoming Events</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">More Tutorials</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/kubernetes-tutorial/" target="_blank">Kubernetes</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/istio-tutorial/" target="_blank">Istio</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/quarkus-tutorial/" target="_blank">Quarkus</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/knative-tutorial/" target="_blank">Knative</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/tekton-tutorial/" target="_blank">Tekton</a>
          </div>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="openshift-hackathon" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html"></a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="00-prerequis.html">0. Pré-requis</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="01-containers.html">1. Challenge 1 - Containers</a>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="02-openshift.html">2. Challenge 2 - OpenShift &amp; CI/CD</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="03-helm_services.html">3. Challenge 3 - Helm et Services</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="04-observability.html">4. Challenge 4 - Observabilité</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="05-resilience.html">5. Challenge 5 - Résilience et scalabilité</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="06-gitops.html">6. Challenge 6 - GitOps</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">Openshift Hackathon</a></li>
    <li><a href="02-openshift.html">2. Challenge 2 - OpenShift &amp; CI/CD</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/redhat-scholars/openshift-hackathon-v2/edit/master/documentation/modules/ROOT/pages/02-openshift.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<article class="doc">
<div class="sect1">
<h2 id="_déployer_votre_image_de_container_sur_openshift_avec_gitlab_cicd"><a class="anchor" href="#_déployer_votre_image_de_container_sur_openshift_avec_gitlab_cicd"></a>Déployer votre image de container sur OpenShift avec GitLab CI/CD</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Ce matin vous avez créé votre image de container, il est maintenant temps de la déployer sur votre cluster OpenShift !</p>
</div>
<div class="sect2">
<h3 id="exercice1"><a class="anchor" href="#exercice1"></a>Déployer directement l&#8217;image sur OpenShift [<strong>Challenge 2.1</strong>]  <em>Beginner</em></h3>
<div class="paragraph">
<p>Utilisez la perspective "Developer" de votre console OpenShift pour déployer votre image.
Vous pouvez utiliser le projet <strong>"default"</strong> pour cette étape.
Ajouter également la variable d&#8217;environnement <code>PING</code> avec la valeur DIOD.
Profitez en pour vous familiariser avec les objets OpenShift (POD, Deployment, Service, Route &#8230;&#8203;).</p>
</div>
<div class="sect3">
<h4 id="_preuves_à_fournir"><a class="anchor" href="#_preuves_à_fournir"></a>Preuves à fournir</h4>
<div class="ulist">
<ul>
<li>
<p>[<strong>Challenge 2.1.1</strong>] L&#8217;URL de la route de votre application</p>
</li>
<li>
<p>[<strong>Challenge 2.1.2</strong>] Screenshot montrant que vous avez réussi à scaler l&#8217;application à 2 Pods</p>
</li>
<li>
<p>[<strong>Challenge 2.1.3</strong>] Screenshot de la page /rest/ping avec la valeur DIOD</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="exercice2"><a class="anchor" href="#exercice2"></a>Déployer l&#8217;application sur OpenShift avec GitLab CI/CD [<strong>Challenge 2.2</strong>]  <em>Advanced</em></h3>
<div class="paragraph">
<p>Pour ce challenge, créer le projet <strong>"diod"</strong> sur votre cluster OpenShift.</p>
</div>
<div class="paragraph">
<p>Avant de pouvoir utiliser GitLab avec OpenShift il faut que vous installiez un "GitLab runner" sur OpenShift.  Le runner est fourni par l&#8217;intermédiaire d&#8217;un Operator. Il va falloir que vous exploriez votre cluster pour trouver comment l&#8217;installer.
N&#8217;oubliez pas de créer un secret pour le runner avant de le déployer.  Pour faire cela vous devrez récupérer le token dans la partie Settings &gt; CI/CD &gt; Runners de votre projet GitLab.
Pour créer le secret, utilisez le manifest suivant (celui de la documentation étant mal formaté) :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">apiVersion: v1
kind: Secret
metadata:
    name: gitlab-runner-secret
type: Opaque
stringData:
    runner-registration-token: LE_TOKEN_GITLAB</code></pre>
</div>
</div>
<div class="paragraph">
<p>Le runner devra être déployé dans le namespace <strong>"diod"</strong>.</p>
</div>
<div class="paragraph">
<p>Une fois installé le GitLab runner, vous allez devoir créer un pipeline (.gitlab-ci.yml) pour builder l&#8217;application et le pousser vers OpenShift (qui va s&#8217;occuper de containeriser l&#8217;application et faire un déploiement 'rolling').
Il y a un .gitlab-ci.yml déjà présent dans le repo pour vous mettre en route, mais n’hésitez pas de le modifier.  Le meilleur .gitlab-ci.yml gagnera peut-être quelques points bonus :)
Les jobs auront besoin des droits corrects pour pouvoir manipuler votre projet OpenShift.  Voici un exemple de comment configurer le RBAC si votre runner tourne dans le même projet (diod) que l&#8217;application:</p>
</div>
<div class="paragraph">
<p><code>oc policy add-role-to-user edit system:serviceaccount:diod:default -n diod
clusterrole.rbac.authorization.k8s.io/edit added: "system:serviceaccount:diod:default"</code></p>
</div>
<div class="sect3">
<h4 id="_preuves_à_fournir_2"><a class="anchor" href="#_preuves_à_fournir_2"></a>Preuves à fournir</h4>
<div class="ulist">
<ul>
<li>
<p>[<strong>Challenge 2.2.1</strong>] Screenshot de l&#8217;Operator installé</p>
</li>
<li>
<p>[<strong>Challenge 2.2.2</strong>] Screenshot de GitLab CI/CD qui montre le Runner qui tourne sur OpenShift s&#8217;est connecté à GitLab</p>
</li>
<li>
<p>[<strong>Challenge 2.2.3</strong>] L&#8217;URL de votre repo GitLab qui contient le pipeline (qui a bien évidemment réussi)</p>
</li>
<li>
<p>[<strong>Challenge 2.2.4</strong>] Screenshot des ressources k8s générées</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="01-containers.html">1. Challenge 1 - Containers</a></span>
  <span class="next"><a href="03-helm_services.html">3. Challenge 3 - Helm et Services</a></span>
</nav>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <a class="rhd-logo" href="https://developers.redhat.com" target="_blank"></div>
</footer>
<script src="../_/js/vendor/clipboard.js"></script>
<script src="../_/js/site.js"></script>
<script async src="../_/js/vendor/highlight.js"></script>
  </body>
</html>
